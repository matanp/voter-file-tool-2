# 1.R.21 High-Risk Route Test Coverage (P2)

**Status:** Open
**Priority:** P2 — Medium
**Effort:** 0.5–1 day
**Depends on:** [1.R.20 Admin Flow Audit Coverage](1.R.20-admin-flow-audit-coverage.md), [1.4 Seat Model](1.4-seat-model.md)

## Summary

Close the remaining Phase 1 code-review test gap by adding route-level coverage for weighted-table import and cross-committee safety constraints.

## Acceptance Criteria

- [ ] Add route tests for `/api/admin/weightedTable/import` covering:
  - ambiguous LTED rows are skipped/rejected deterministically.
  - full-key (city/town + LD + ED + term) targeting updates exactly one committee.
- [ ] Add negative-path tests for discrepancy acceptance rejecting voters already active in another committee.
- [ ] Add tests for bulk import duplicate assignments across committees in the same term resulting in discrepancy handling (not dual ACTIVE memberships).
- [ ] Add at least one regression test proving single-active-membership invariant is preserved after admin bulk/discrepancy workflows.

## Implementation Notes

- **Likely test files:**
  - `apps/frontend/src/__tests__/api/admin/weightedTableImport.test.ts`
  - `apps/frontend/src/__tests__/api/admin/handleCommitteeDiscrepancy.test.ts`
  - `apps/frontend/src/__tests__/api/admin/bulkLoadCommittees.bulkLoadUtils.test.ts`

## Related

- [PHASE1_CODE_REVIEW_FINDINGS.md](../PHASE1_CODE_REVIEW_FINDINGS.md) (Finding 6)
- [T1.3 Discrepancy Handling Tests](T1.3-discrepancy-handling-tests.md)
