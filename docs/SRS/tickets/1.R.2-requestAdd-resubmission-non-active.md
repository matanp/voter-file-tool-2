# 1.R.2 requestAdd Resubmission for Non-Active Memberships (P1)

**Status:** Open
**Priority:** P1 — High
**Effort:** 0.5–1 day
**Depends on:** [1.2 CommitteeMembership Model](1.2-committee-membership-model.md)

## Summary

`requestAdd` cannot resubmit for voters who have an existing **non-active** membership (REJECTED, REMOVED, RESIGNED, etc.) in the same committee/term. The route only checks for SUBMITTED (idempotent return) and ACTIVE (error). For any other status, it falls through and calls `create`, which violates the unique constraint `@@unique([voterRecordId, committeeListId, termId])` and results in **500 errors** instead of transitioning the existing record back to SUBMITTED per the status-transition model.

## Root Cause

- **File:** `apps/frontend/src/app/api/committee/requestAdd/route.ts` (lines 114–140)
- Checks: `existing?.status === "SUBMITTED"` → return 200; `existing?.status === "ACTIVE"` → return 400
- For REJECTED, REMOVED, RESIGNED, etc.: no branch → `create` → unique violation

## Acceptance Criteria

- [ ] When an existing `CommitteeMembership` exists with status in {REJECTED, REMOVED, RESIGNED, PETITIONED_*}, and the same voter/committee/term is submitted again:
  - **Update** the existing record to `status=SUBMITTED`, `submittedAt=now`, `submittedById=session.user.id`, clear terminal fields (e.g. `rejectedAt`, `removalReason`) as appropriate, and preserve/update `submissionMetadata`.
  - Return 201 with success message (same as new create).
- [ ] Do not create a duplicate `CommitteeMembership`; always use update when a record exists for the unique key.
- [ ] Add route test: resubmit for voter with REJECTED membership → succeeds, record transitions to SUBMITTED.
- [ ] Add route test: resubmit for voter with REMOVED membership → succeeds.

## Implementation Notes

- **File:** `apps/frontend/src/app/api/committee/requestAdd/route.ts`
- Unique constraint: `voterRecordId_committeeListId_termId` (schema.prisma line 375)
- Use `prisma.committeeMembership.upsert` or explicit find-then-update; avoid raw `create` when record may exist.
- Preserve `removeMemberId` and `requestNotes` in `submissionMetadata` when transitioning.

## Related

- [1.2 CommitteeMembership Model](1.2-committee-membership-model.md)
- [SRS_DATA_MODEL_CHANGES](../SRS_DATA_MODEL_CHANGES.md) — membership lifecycle
