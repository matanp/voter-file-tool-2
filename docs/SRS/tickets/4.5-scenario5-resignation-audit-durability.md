# 4.5 Scenario 5: Resignation Audit Durability + Reason Capture

**Status:** Done  
**Priority:** P0 (Critical)  
**Effort:** 2-4 days  
**Depends on:** [2.3 Resignation Workflow](2.3-resignation-workflow.md), [2.5 Structured Removal with Reasons](2.5-structured-removal-reasons.md), [1.5 Audit Trail Infrastructure](1.5-audit-trail-infrastructure.md)

## Summary

Make resignation/removal audit behavior durable and preserve full reason context required for defensibility.

## Acceptance Criteria

### Audit Durability

- [x] Resignation/removal mutations and their audit writes are handled under a documented durability policy:
  - transactional write (mutation fails if audit insert fails), or
  - explicit durable retry/dead-letter path with operator visibility.
- [x] The chosen policy is implemented for `/api/committee/remove` and any route that confirms membership removals.
- [x] Silent audit failure in compliance-critical membership mutations is eliminated.

### Reason + Notes Capture

- [x] Validation schema includes structured resignation reason (`resignationReason` or mapped `RemovalReason`) per product rule.
- [x] Resignation reason is persisted in membership/removal records and included in audit payload.
- [x] Optional operator notes are preserved in audit `afterValue` (or metadata) when provided.

### Tests

- [x] Route tests verify mutation failure behavior when audit write fails under chosen policy.
- [x] Route tests verify reason and notes are persisted and audited.
- [x] Regression test verifies legacy remove flow still works with required reason semantics.

## Implementation Notes

- Durability policy chosen: **transactional fail-closed** for compliance-critical membership removals/resignations.
- Shared audit utility now supports strict mode via `logAuditEventOrThrow`:
  - if audit insert fails, the route transaction throws and request fails.
- Applied to:
  - `POST /api/committee/remove` (resignation + administrative removal)
  - replacement-removal branch in `POST /api/committee/handleRequest`
  - confirm-removal branch in `POST /api/admin/eligibility-flags/[id]/review`
- Resignation contract now requires `resignationReason` (mapped to `RemovalReason`):
  - persisted to `CommitteeMembership.removalReason`
  - included in resignation audit `afterValue`
  - `removalNotes` is included in audit `afterValue` when provided
- Added/updated tests cover:
  - strict audit failure behavior (500) for removal/resignation confirmation paths
  - resignation reason persistence and audit payload shape
  - legacy remove flow semantics (`removalReason` required, `OTHER` requires notes)

## Related

- [SCENARIO_5_RESIGNATION_MISSING_2026-02-23.md](../scenario-gaps/SCENARIO_5_RESIGNATION_MISSING_2026-02-23.md)
