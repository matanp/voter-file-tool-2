# 1.R.4 Bulk Committee Import Incompatible with Phase 1 Schema (P1)

**Status:** Open
**Priority:** P1 — High
**Effort:** 2–3 days
**Depends on:** [1.2 CommitteeMembership Model](1.2-committee-membership-model.md), [1.4 Seat Model](1.4-seat-model.md)

## Summary

`bulkLoadCommittees` (via `bulkLoadUtils.ts`) still uses the deprecated membership model. It performs `committeeList.deleteMany({})`, which can cascade or conflict with Phase 1 FKs (Seat, CommitteeMembership reference CommitteeList). It also writes `VoterRecord.committeeId` instead of creating/updating `CommitteeMembership` records. This is a high-risk failure path; even if it runs, it bypasses the new authoritative membership model and can corrupt term history.

## Root Cause

- **File:** `apps/frontend/src/app/api/admin/bulkLoadCommittees/bulkLoadUtils.ts`
- Line 137: `prisma.committeeList.deleteMany({})` — dangerous with restrict FKs
- Line 157: `prisma.voterRecord.updateMany({ data: { committeeId: committee.id } })` — deprecated field

## Acceptance Criteria

- [ ] Stop writing `VoterRecord.committeeId`; do not use it for membership.
- [ ] For each committee in the import:
  - Upsert `CommitteeList` (or equivalent) without full delete-first.
  - Create/update `CommitteeMembership` records with `status=ACTIVE` for each member, linked to the correct `committeeListId` and `termId`.
  - Use `ensureSeatsExist` and `assignNextAvailableSeat` (or bulk equivalent) for seat assignment.
- [ ] Remove or replace `committeeList.deleteMany({})` with a safe strategy (e.g. per-committee upsert, or explicit term-scoped replace that respects FK constraints).
- [ ] Ensure Seat and CommitteeMembership FKs are satisfied; no orphaned or invalid references.
- [ ] Add/update bulk import tests to assert CommitteeMembership creation and no `committeeId` writes.
- [ ] Document migration path for existing bulk-import data if `committeeId` was populated.

## Implementation Notes

- **File:** `apps/frontend/src/app/api/admin/bulkLoadCommittees/bulkLoadUtils.ts`
- Phase 1 source of truth: `CommitteeMembership` with `Seat` for assignment.
- Consider transaction scope for bulk operations to avoid partial state.
- Reference `add` route and `handleRequest` for patterns (ensureSeatsExist, assignNextAvailableSeat).

## Related

- [1.2 CommitteeMembership Model](1.2-committee-membership-model.md)
- [1.4 Seat Model](1.4-seat-model.md)
- [1.R.5 Source-of-Truth Split](1.R.5-source-of-truth-split.md)
