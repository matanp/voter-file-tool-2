# 1.R.6 Audit Tests Fail: AuditAction Undefined in Jest (P2)

**Status:** Open
**Priority:** P2 — Medium
**Effort:** 0.5 day
**Depends on:** [1.5b Audit Log Utility](1.5b-audit-log-utility-and-immutability.md)

## Summary

Ticket 1.5b is marked done, but the default Jest run currently fails for audit tests. `auditLog.test.ts` uses `AuditAction` from `@prisma/client` (line 24), while Jest's Prisma mock (`jest.setup.ts` line 95) only stubs `RemovalReason`. The `AuditAction` enum may be undefined or not properly exported in the test environment, causing audit tests to fail.

## Root Cause

- **File:** `apps/frontend/src/__tests__/lib/auditLog.test.ts` — imports `AuditAction`
- **File:** `apps/frontend/jest.setup.ts` — Prisma mock spreads `actual` but may not expose `AuditAction` correctly in all test scenarios
- **Effect:** `AuditAction` undefined → test failures in audit suite

## Acceptance Criteria

- [ ] Ensure `AuditAction` is available in Jest when running audit tests (e.g. add to Prisma mock stubs if needed, or ensure `jest.requireActual` preserves it).
- [ ] Default `pnpm --filter voter-file-tool test` passes including `auditLog.test.ts` and `auditLogImmutability.test.ts`.
- [ ] No need to run migrations in test env if mock suffices; document if generated client is required for audit enums.

## Implementation Notes

- **Files:** `apps/frontend/jest.setup.ts`, `apps/frontend/src/__tests__/lib/auditLog.test.ts`
- **Options:** (a) Add `AuditAction` to the `@prisma/client` mock stub with enum values; (b) Ensure `...actual` correctly re-exports enums; (c) Adjust test to not rely on enum at module-load time.
- Verify `AuditAction` exists in `schema.prisma` and is generated (migration `20260219061109_audit_log_schema`).

## Related

- [1.5b Audit Log Utility](1.5b-audit-log-utility-and-immutability.md)
- [T1.1 handleRequest Route Tests](T1.1-handleRequest-route-tests.md) — similar test setup considerations
