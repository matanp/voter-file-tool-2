# 1.R.10 updateLtedWeight Atomicity for Weight Recompute (P2)

**Status:** Open
**Priority:** P2 â€” Medium
**Effort:** 1 day
**Depends on:** [1.4 Seat Model](1.4-seat-model.md)

## Summary

`PATCH /api/committee/updateLtedWeight` updates LTED weight and then recomputes seat weights in a separate step. If recompute fails after the update succeeds, persisted data can become inconsistent. This ticket makes the update + recompute flow atomic.

## Acceptance Criteria

- [ ] Refactor `recomputeSeatWeights` to accept a Prisma transaction client (or equivalent transactional execution context).
- [ ] Wrap LTED weight update + seat-weight recompute in a single `prisma.$transaction(...)`.
- [ ] Ensure recompute failure rolls back the LTED weight update.
- [ ] Add/extend tests proving rollback behavior and successful atomic path.
- [ ] Document transaction boundaries in route/util comments.

## Implementation Notes

- Keep read/compute/write operations within the same transaction where practical.
- If utility signatures change, update all call sites and tests in the same PR.

## Related

- [FINDINGS_REMEDIATION_LOG.md](../../CODEBASE_AUDIT/FINDINGS_REMEDIATION_LOG.md) item 17
- [1.4 Seat Model](1.4-seat-model.md)
