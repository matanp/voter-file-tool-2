# 1.R.16 useApiQuery Type Safety and Cleanup (P2)

**Status:** Open
**Priority:** P2 — Medium
**Effort:** 0.5 day
**Depends on:** —

## Summary

Improve useApiQuery: (1) the 204/no-body branch uses `null as TData`, breaking type safety when `TData` is non-nullable—make data state and return type explicitly `TData | null` and fix call sites; (2) refetch does not clean up on unmount, so in-flight fetch can call setState after unmount—use AbortController and cleanup on unmount.

## Acceptance Criteria

- [ ] Make the hook's data state and return type explicitly `TData | null` (or constrain generic so callers opt into nullable when using 204). Replace `null as TData` with properly typed `null`. Adjust call sites that assume non-null `data` where appropriate.
- [ ] In refetch: store AbortController and timeout id in refs; pass `controller.signal` to `fetch`. In a useEffect cleanup, abort the controller and clear the timeout on unmount. Ensure refetch still clears timeout and resets controller after completion so subsequent calls work.

## Implementation Notes

- **Files:** [apps/frontend/src/hooks/useApiQuery.ts](apps/frontend/src/hooks/useApiQuery.ts). Check all call sites of useApiQuery for `data` nullability.

## Related

- [FINDINGS_AND_RESOLUTION_REGISTER.md](../../FINDINGS_AND_RESOLUTION_REGISTER.md) (Findings 13, 14)
