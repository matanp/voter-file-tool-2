# T1.4 Voter Import Processor Tests

**Status:** Open
**Roadmap:** [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) Testing Tier 1 §T1.4
**Effort:** 2–3 days
**Depends on:** Nothing (can run in parallel)

## Summary

Add automated tests for the voter-import processing package to cover parsing, transformation, and persistence behavior in the highest-risk data ingestion path.

## Acceptance Criteria

- [ ] Add test infrastructure for `packages/voter-import-processor` if missing (`jest.config` or equivalent, mocks setup).
- [ ] CSV parsing coverage:
  - valid file path
  - malformed rows
  - missing required columns
  - encoding edge cases
- [ ] Record transformation coverage:
  - field mapping correctness
  - date parsing/conversion behavior
  - normalization defaults for empty values
- [ ] Persistence coverage:
  - create vs update logic
  - newer-record/last-write behavior
  - batched writes
- [ ] Dropdown extraction/save behavior is tested.
- [ ] Archive/cleanup behavior is tested for stale records where applicable.
- [ ] At least one large-input test validates buffered batch handling without per-row DB writes.

## Implementation Notes

- **Files to test:**
  - `packages/voter-import-processor/src/voterRecordProcessor.ts`
  - `packages/voter-import-processor/src/parseVoterFile.ts`
  - `packages/voter-import-processor/src/dropdownListProcessor.ts`
- Prefer deterministic fixtures over ad hoc inline CSV strings for multi-case coverage.

## Related

- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) Testing Tier 1 §T1.4
- [T1.3 Committee Discrepancy Handling Tests](T1.3-discrepancy-handling-tests.md)

