# 0.1 Backend Enforcement for "Already in Another Committee"

**Status:** Done
**Roadmap:** [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §0.1
**Effort:** 0.5–1 day
**Depends on:** None

## Summary

Add server-side validation to reject add/request flows when a voter already has `committeeId` set to a different committee. The UI currently disables "Add" in this case, but the backend does not enforce this check — a direct API call could bypass it.

## Acceptance Criteria

- [x] In `POST /api/committee/add`: Before connect, check if voter has `committeeId` set to a different committee; if so, return 400 with structured error
- [x] In `POST /api/committee/requestAdd`: Same check before creating CommitteeRequest
- [x] In `POST /api/committee/handleRequest` (accept flow): Same check before connecting — replacement requests handle remove-then-add; ensure add path rejects if voter is in another committee and this is not a replacement
- [x] Add/update tests in `add.test.ts`, `requestAdd.test.ts`; add or update `handleRequest.test.ts` if not yet present

## Implementation Notes

- **Files:** `apps/frontend/src/app/api/committee/add/route.ts`, `requestAdd/route.ts`, `handleRequest/route.ts`
- **Tests:** `apps/frontend/src/__tests__/api/committee/add.test.ts`, `requestAdd.test.ts`, `handleRequest.test.ts`
- Return structured error (e.g., `{ code: "ALREADY_IN_ANOTHER_COMMITTEE", message: "..." }`) for consistent client handling

## Related

- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §0.1
- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.1 — eligibility validation will handle this with the new model
