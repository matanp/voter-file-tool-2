# 1.R.15 API and Audit Robustness (P2)

**Status:** Resolved
**Priority:** P2 â€” Medium
**Effort:** 0.5 day
**Depends on:** [1.4 Seat Model](1.4-seat-model.md), [1.5 Audit Trail Infrastructure](1.5-audit-trail-infrastructure.md)

## Summary

Harden API and audit code: (1) updateLtedWeight should return 400 on malformed JSON instead of 500 and include a one-line handler comment; (2) auditLog catch block should support optional rethrow for compliance; (3) auditLogGuard should block `upsert` on AuditLog in addition to update/delete.

## Acceptance Criteria

- [x] In updateLtedWeight route: wrap `await req.json()` in try/catch; on parse failure return `NextResponse.json({ error: "Invalid JSON body" }, { status: 400 })`. Add a one-line comment above the handler describing its purpose.
- [x] In auditLog: add optional parameter (e.g. `throwOnError = false`); after `console.error`, rethrow when `throwOnError` is true. If API change is deferred, add TODO in catch block referencing action, entityType, entityId and note rethrow/throwOnError for compliance.
- [x] In auditLogGuard: extend condition to include `params.action === "upsert"` and update thrown message to list "update, updateMany, delete, deleteMany, upsert operations are not allowed".

## Implementation Notes

- **Files:** [apps/frontend/src/app/api/committee/updateLtedWeight/route.ts](apps/frontend/src/app/api/committee/updateLtedWeight/route.ts), [apps/frontend/src/lib/auditLog.ts](apps/frontend/src/lib/auditLog.ts), [apps/frontend/src/lib/auditLogGuard.ts](apps/frontend/src/lib/auditLogGuard.ts).

## Related

- [FINDINGS_AND_RESOLUTION_REGISTER.md](../FINDINGS_AND_RESOLUTION_REGISTER.md) (Findings 10, 15, 16)
