# 2.5 Structured Removal with Reasons

**Status:** Done
**Roadmap:** [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.5
**Effort:** 1–2 days
**Depends on:** [1.2 CommitteeMembership Model](1.2-committee-membership-model.md), [2.3 Resignation Workflow](2.3-resignation-workflow.md)

## Summary

Standardize administrative removals so every `REMOVED` transition captures a structured reason and optional notes, and is clearly separated from resignation. This ticket hardens the current `committee/remove` behavior (currently permissive) into a consistent, auditable removal workflow.

## Acceptance Criteria

### API Contract

- [ ] Keep `POST /api/committee/remove` as the primary removal endpoint.
- [ ] Request schema becomes explicit and strict for administrative removal:

```ts
{
  cityTown: string;
  legDistrict?: number;
  electionDistrict: number;
  memberId: string;
  removalReason: RemovalReason;      // required
  removalNotes?: string;             // required when removalReason=OTHER
}
```

- [ ] Validation rules:
  - `removalReason` is required.
  - `removalReason=OTHER` requires non-empty `removalNotes`.
  - `removalNotes` max length 1000.

- [ ] Membership guards:
  - 404 if membership not found.
  - 400 if membership is not currently `ACTIVE`.

### Status Transition

- [ ] Successful removal updates `CommitteeMembership`:
  - `status = REMOVED`
  - `removedAt = now()`
  - `removalReason = <enum>`
  - `removalNotes` as provided
- [ ] Seat is treated as available by existing active-membership-based seat assignment logic (no manual seat mutation required).

### Distinction from Resignation

- [ ] `RESIGNED` flow remains in 2.3 and is not reachable through removal reason UI.
- [ ] UI labels and API error messages explicitly distinguish:
  - "Record Resignation" (2.3)
  - "Remove Member" (2.5)

### Audit Logging

- [ ] `MEMBER_REMOVED` audit event includes:
  - `beforeValue`: `{ status: "ACTIVE", seatNumber }`
  - `afterValue`: `{ status: "REMOVED", removalReason, removalNotes }`
- [ ] Include metadata origin:
  - `metadata.source = "manual"` for admin UI removals
  - `metadata.source = "boe_flagging"` for 2.8-confirmed removals

### UI

- [ ] In `apps/frontend/src/app/committees/CommitteeSelector.tsx`, replacing immediate remove with reasoned form:
  - Add "Remove Member" action that opens modal/dialog.
  - Required reason dropdown (friendly labels).
  - Notes textarea shown for all reasons, required for `OTHER`.
- [ ] Friendly labels mapping:
  - `PARTY_CHANGE` -> "Party change"
  - `MOVED_OUT_OF_DISTRICT` -> "Moved out of district"
  - `INACTIVE_REGISTRATION` -> "Inactive registration"
  - `DECEASED` -> "Deceased"
  - `OTHER` -> "Other"

### Tests

- [ ] Route tests (`apps/frontend/src/__tests__/api/committee/remove.test.ts`):
  - fails when `removalReason` missing
  - fails when `OTHER` and notes missing
  - succeeds with each enum value
  - rejects non-`ACTIVE` membership
  - audit payload contains reason + metadata source
- [ ] Component test for removal modal validation path (reason required, notes required for OTHER).

## Implementation Notes

- **Current state:** schema already has `RemovalReason` enum and `CommitteeMembership.removalReason/removalNotes`; this ticket enforces required usage and UX.
- **No destructive deletes:** removal is status-based only; membership history remains intact.
- **2.8 readiness:** this contract is the destination for BOE flag review confirmations.

## Related

- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.5, §6.6
- [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §1 (`RemovalReason`), §2 (`CommitteeMembership` removal fields)
- [SRS_UI_PLANNING_GAPS.md](../SRS_UI_PLANNING_GAPS.md) §4
- [2.3 Resignation Workflow](2.3-resignation-workflow.md)
- [2.8 BOE Eligibility Flagging](2.8-boe-driven-automatic-eligibility-flagging.md)
