# 2.4 Meeting Record + Executive Committee Confirmation Workflow

**Status:** Done
**Roadmap:** [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.4
**Effort:** 3–5 days
**Depends on:** [1.2 CommitteeMembership Model](1.2-committee-membership-model.md), [1.4 Seat Model](1.4-seat-model.md), [IA-01 Admin IA v1 spec](IA-01-admin-ia-v1-spec.md)

## Summary

Implement a meeting-centric confirmation workflow for pending memberships. Admin creates a `MeetingRecord`, selects `SUBMITTED` memberships, then bulk-confirms or bulk-rejects them. Confirmed memberships are activated with seat assignment and linked to the meeting for traceability.

## Acceptance Criteria

### Schema

- [x] Add `MeetingType` enum to `apps/frontend/prisma/schema.prisma`:

```prisma
enum MeetingType {
  EXECUTIVE_COMMITTEE
  OTHER
}
```

- [x] Add `MeetingRecord` model:

```prisma
model MeetingRecord {
  id          String      @id @default(cuid())
  meetingDate DateTime
  meetingType MeetingType @default(EXECUTIVE_COMMITTEE)
  notes       String?
  createdById String
  createdBy   User        @relation("CreatedMeetings", fields: [createdById], references: [id])
  createdAt   DateTime    @default(now())

  memberships CommitteeMembership[]

  @@index([meetingDate])
  @@index([createdById])
}
```

- [x] Replace placeholder `meetingRecordId String?` on `CommitteeMembership` with a real relation:

```prisma
meetingRecordId String?
meetingRecord   MeetingRecord? @relation(fields: [meetingRecordId], references: [id])
```

- [x] Add relation field on `User`:

```prisma
createdMeetings MeetingRecord[] @relation("CreatedMeetings")
```

### API: Meeting Lifecycle

- [x] Create `POST /api/admin/meetings`:
  - Admin-only.
  - Body: `{ meetingDate, meetingType?, notes? }`.
  - Creates `MeetingRecord`.
  - Logs `MEETING_CREATED` audit event.

- [x] Create `GET /api/admin/meetings`:
  - Admin-only.
  - Returns paginated meeting list with membership counts per meeting.

- [x] Create `GET /api/admin/meetings/[meetingId]/submissions`:
  - Admin-only.
  - Returns candidate `CommitteeMembership` records with `status=SUBMITTED` eligible for this meeting.
  - Include committee display fields and current warning metadata when present.

### API: Bulk Decisions

- [x] Create `POST /api/admin/meetings/[meetingId]/decisions`:
  - Admin-only.
  - Body:

```ts
{
  decisions: Array<{
    membershipId: string;
    decision: "confirm" | "reject";
    rejectionNote?: string;
  }>;
}
```

- [x] Process all decisions in a transaction.

- [x] For `confirm`:
  - Transition `SUBMITTED -> CONFIRMED` (`confirmedAt=now`).
  - Immediately transition `CONFIRMED -> ACTIVE` (`activatedAt=now`) for v1.
  - Set `meetingRecordId` to current meeting.
  - Ensure seats exist (`ensureSeatsExist`) and assign seat (`assignNextAvailableSeat`).
  - Set `membershipType="APPOINTED"` if null.
  - Log both `MEMBER_CONFIRMED` and `MEMBER_ACTIVATED`.

- [x] For `reject`:
  - Transition `SUBMITTED -> REJECTED`.
  - Set `rejectedAt=now`, `rejectionNote` optional.
  - Set `meetingRecordId` to current meeting.
  - Log `MEMBER_REJECTED`.

- [x] Validation and error handling:
  - 404 if meeting does not exist.
  - Per-decision failure when membership is not `SUBMITTED` (success: false, error message in results).
  - Per-membership capacity guard before activation; if full, decision returns explicit error in results.

### Existing Routes Compatibility

- [x] Keep `/api/committee/handleRequest` for one-off handling.
- [ ] Add optional `meetingRecordId` support on accept/reject path when called from meeting UI (deferred; bulk flow uses dedicated decisions endpoint).
- [x] Do not remove `/committees/requests` in this ticket.

### Admin UI

- [x] Enable `/admin/meetings` in `apps/frontend/src/config/adminNav.ts` (`enabled: true`).
- [x] Add page and components:
  - `apps/frontend/src/app/admin/meetings/page.tsx`
  - `apps/frontend/src/app/admin/meetings/MeetingsManagement.tsx`
  - `apps/frontend/src/app/admin/meetings/CreateMeetingDialog.tsx`
  - `apps/frontend/src/app/admin/meetings/PendingSubmissionsTable.tsx`
- [x] Workflow:
  - Create/select meeting.
  - Review pending submissions.
  - Multi-select and bulk confirm/reject.
  - Rejection note input UI for rejected rows.
- [x] On `/committees/requests`, add clear CTA linking to `/admin/meetings` for bulk processing.

### Audit Logging

- [x] `MEETING_CREATED` on meeting creation.
- [x] `MEMBER_CONFIRMED` and `MEMBER_ACTIVATED` on confirm.
- [x] `MEMBER_REJECTED` on reject.
- [x] Include `metadata.meetingRecordId` in all membership decision audit events.

### Tests

- [x] Migration for schema (MeetingRecord, MeetingType, relations).
- [x] API tests:
  - create meeting success/failure
  - bulk confirm assigns seat and sets meeting reference
  - bulk reject sets `REJECTED` fields and meeting reference
  - non-`SUBMITTED` membership returns per-decision failure with clear error
  - capacity collision returns deterministic error in results
- [ ] UI behavior tests for selection/bulk actions (optional follow-up).

## Implementation Notes

- **Schema:** `MeetingRecord` omits `@@index([meetingDate])` and `@@index([createdById])`; add in a future migration if query performance requires it.
- **Status sequencing:** keep both `confirmedAt` and `activatedAt` even when same timestamp in v1; this preserves lifecycle semantics.
- **Seat assignment source of truth:** reuse existing `assignNextAvailableSeat` in `apps/frontend/src/app/api/lib/seatUtils.ts`.
- **Requests page transition:** aligns with [IA-01 implementation action items](../IA-01-implementation-action-items.md) §4.
- **Meeting scope:** v1 supports single meeting type (`EXECUTIVE_COMMITTEE`) with `OTHER` as future-safe enum value.

## Related

- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.4, §6.4, §9.3
- [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §1 (`MeetingType`), §2 (`MeetingRecord`)
- [SRS_UI_PLANNING_GAPS.md](../SRS_UI_PLANNING_GAPS.md) §2
- [IA-01-admin-ia-v1-spec.md](IA-01-admin-ia-v1-spec.md)
- [2.3 Resignation Workflow](2.3-resignation-workflow.md)
- [2.5 Structured Removal](2.5-structured-removal-reasons.md)
