# 1.4 Seat Model

**Status:** Open
**Roadmap:** [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §1.4
**Effort:** 3–5 days
**Depends on:** [1.1 Committee Term Model](1.1-committee-term-model.md) (done), [1.1c Governance Config](1.1c-committee-governance-config.md) (done), [1.2 CommitteeMembership Model](1.2-committee-membership-model.md)

## Open Question

**Does the BOE export include LTED total weight, or does admin enter it manually?**
Plan for manual entry as fallback (field on `CommitteeList`). If BOE export format is confirmed to include weight, the import pipeline can populate `ltedWeight` automatically. See [SRS_LTED_WEIGHT_SOURCE.md](../SRS_LTED_WEIGHT_SOURCE.md) for current thinking.

## Summary

Introduce the `Seat` model to explicitly represent each seat slot within a committee for a given term. Seats track whether they were established via petition and carry a designation weight (LTED total weight / `maxSeatsPerLted`). On membership activation, the smallest unused seat number for that committee+term is assigned to the `CommitteeMembership`.

## Acceptance Criteria

### Schema

- [ ] New `Seat` model per [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §2:
  - `id String @id @default(cuid())`
  - `committeeListId Int` (FK → `CommitteeList.id`)
  - `termId String` (FK → `CommitteeTerm.id`)
  - `seatNumber Int` — 1-based, range 1–`maxSeatsPerLted`
  - `isPetitioned Boolean @default(false)` — immutable once set for the term
  - `weight Decimal?` — computed as `ltedWeight / maxSeatsPerLted`; null until LTED weight is known
  - `@@unique([committeeListId, termId, seatNumber])`
  - `@@index([committeeListId, termId])`
- [ ] Add `ltedWeight Decimal?` field to `CommitteeList` model (per [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §3.1)
- [ ] Add `seats Seat[]` relation to `CommitteeList` and `CommitteeTerm`

### Migration

- [ ] Add `Seat` table and `CommitteeList.ltedWeight` column via Prisma migration
- [ ] Backfill: create `maxSeatsPerLted` `Seat` records per `CommitteeList` per active term (read `maxSeatsPerLted` from `CommitteeGovernanceConfig`, not hardcoded)
- [ ] Seat weights left null until `ltedWeight` is entered by admin

### Seat Assignment Logic

- [ ] Helper function `assignNextAvailableSeat(committeeListId: number, termId: string): Promise<number>`:
  - Queries all `Seat` records for the given `committeeListId` + `termId`
  - Queries all `CommitteeMembership` records with `status=ACTIVE` and a non-null `seatNumber` for the same committee+term
  - Returns the smallest `seatNumber` (1-based) not currently occupied by an active membership
  - Throws if all seats are occupied (should not happen if capacity check in 1.2 passes first)
- [ ] Call `assignNextAvailableSeat` when transitioning a `CommitteeMembership` to `ACTIVE` status (in `committee/add` and `committee/handleRequest`)
- [ ] Set `CommitteeMembership.seatNumber` to the assigned value on activation

### Weight Computation

- [ ] When `CommitteeList.ltedWeight` is set or updated, recompute and persist `Seat.weight = ltedWeight / maxSeatsPerLted` for all seats in that committee (current term)
- [ ] Utility function `recomputeSeatWeights(committeeListId: number): Promise<void>` — called after admin sets `ltedWeight`

### Admin UI

- [ ] Committee detail view (or admin data panel): editable "LTED Total Weight" field on `CommitteeList`
- [ ] On save, call `recomputeSeatWeights` and display updated per-seat weight
- [ ] Display seat roster: list seats 1–4 with occupant name (from active `CommitteeMembership` with matching `seatNumber`), `isPetitioned`, and `weight`

## Implementation Notes

- **`maxSeatsPerLted`:** always read from `CommitteeGovernanceConfig` singleton — never hardcode 4
- **Seat creation timing:** seats are created at migration time (backfill) and when a new term is activated; they are not created on-demand per member
- **`isPetitioned`:** set by the petition workflow (future ticket); this ticket creates seats with `isPetitioned=false` by default
- **Seat reuse after resignation:** when a member resigns, their `seatNumber` is freed — `assignNextAvailableSeat` will return it for the next activation
- **Schema spec:** [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §2 (Seat), §3.1 (CommitteeList changes)
- **Weight source:** [SRS_LTED_WEIGHT_SOURCE.md](../SRS_LTED_WEIGHT_SOURCE.md)

## Related

- [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §2 — Seat model, §3.1 — CommitteeList changes
- [SRS_LTED_WEIGHT_SOURCE.md](../SRS_LTED_WEIGHT_SOURCE.md) — how LTED weight is sourced
- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §1.4, §8.1, §8.2
- [1.2 CommitteeMembership Model](1.2-committee-membership-model.md) — `seatNumber` field populated by this ticket
- [1.1c Governance Config](1.1c-committee-governance-config.md) — `maxSeatsPerLted` source
- [2.7 Seat Weight Reports](../SRS_IMPLEMENTATION_ROADMAP.md) — consumes seat weights built here
