# 2.3 Resignation Workflow

**Status:** Open
**Roadmap:** [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.3
**Effort:** 2–3 days
**Depends on:** [1.2 CommitteeMembership Model](1.2-committee-membership-model.md)

## Summary

Implement the admin-facing resignation workflow. A resignation is distinct from a generic administrative removal: it records the date the resignation was received and the method (EMAIL or MAIL). After a resignation, the member's seat becomes available for the next activation.

## Acceptance Criteria

### API

- [ ] Extend `committee/remove` (or add new endpoint `committee/resign`) to accept `action: "RESIGN"` in addition to generic remove behavior:
  - Required fields when `action="RESIGN"`: `resignationDateReceived: string (ISO date)`, `resignationMethod: "EMAIL" | "MAIL"`
  - Optional: `removalNotes: string` (freetext resignation note)
- [ ] On resign:
  - Set `CommitteeMembership.status = RESIGNED`
  - Set `resignedAt = now()`
  - Set `resignationDateReceived` from request body
  - Set `resignationMethod` from request body
  - Set `removalNotes` if provided
  - Clear `seatNumber` or leave as-is (seat becomes available via `assignNextAvailableSeat` returning that number for the next activation — no field clear needed)
- [ ] Auth: Admin-only operation
- [ ] Zod validation: `resignationDateReceived` must be a valid date string; `resignationMethod` must be `EMAIL` or `MAIL`
- [ ] Return updated membership record (or `{ success: true }`) on success
- [ ] 404 if membership not found; 400 if membership is not currently `ACTIVE` (cannot resign a non-active member)

### Audit Logging

- [ ] Log `MEMBER_RESIGNED` to `AuditLog` via `logAuditEvent` after successful status transition:
  - `entityType = "CommitteeMembership"`, `entityId = membership.id`
  - `beforeValue = { status: "ACTIVE", seatNumber }`, `afterValue = { status: "RESIGNED", resignationDateReceived, resignationMethod }`
- [ ] If ticket 1.5 (Audit Trail Infrastructure) is not yet complete: add `// TODO(1.5): log MEMBER_RESIGNED` comment in code and skip the call

### Admin UI

- [ ] Committee member card/roster row: add "Record Resignation" action (button or dropdown item), distinct from "Remove"
- [ ] Resignation form (modal or inline): fields for `resignationDateReceived` (date picker), `resignationMethod` (select: Email / Mail), and optional notes
- [ ] Form validation: date and method are required before submit
- [ ] On successful submit: member card updates to show `status=RESIGNED`; member is no longer shown in the active roster

### Seat Availability

- [ ] After resignation, `assignNextAvailableSeat` (implemented in ticket 1.4) naturally returns the freed seat number for the next activation
- [ ] No explicit seat clearing needed on the `Seat` model — availability is computed dynamically by checking which seat numbers have no active `CommitteeMembership`

## Implementation Notes

- **Distinct from removal:** `committee/remove` handles administrative removals (`status=REMOVED`); resignation sets `status=RESIGNED` with distinct metadata fields. Consider a shared endpoint with an `action` discriminant rather than two separate routes
- **Non-active member guard:** if `CommitteeMembership.status` is not `ACTIVE`, the resignation route should return 400 — resignations only apply to active members
- **`ResignationMethod` enum:** declared in 1.2 schema (`EMAIL`, `MAIL`)
- **UI location:** "Record Resignation" should appear alongside or near the existing "Remove" action in the committee roster admin view
- **Date received vs. date processed:** `resignationDateReceived` is the date the resignation was received by the organization (may be in the past); `resignedAt` is the system timestamp when the record was updated

## Related

- [SRS_DATA_MODEL_CHANGES.md](../SRS_DATA_MODEL_CHANGES.md) §1 — `ResignationMethod` enum, §2 — `CommitteeMembership` resignation fields
- [SRS_IMPLEMENTATION_ROADMAP.md](../SRS_IMPLEMENTATION_ROADMAP.md) §2.3, §6.5
- [1.2 CommitteeMembership Model](1.2-committee-membership-model.md) — declares all resignation fields
- [1.4 Seat Model](1.4-seat-model.md) — `assignNextAvailableSeat` makes freed seat available
- [1.5 Audit Trail Infrastructure](1.5-audit-trail-infrastructure.md) — `logAuditEvent` for `MEMBER_RESIGNED`
